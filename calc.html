<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        
        <div id="calculator">
            <div id="screen">
                <div id="text">0</div>
            </div>
            <div class="button_container">
                <button class="num_button" id="one">1</button>
                <button class="num_button" id="two">2</button>
                <button class="num_button" id="three">3</button>
                <button class="op_button" id="add">+</button>
                <button class="num_button" id="four">4</button>
                <button class="num_button" id="five">5</button>
                <button class="num_button" id="six">6</button>
                <button class="op_button" id="minus">-</button>
                <button class="num_button" id="seven">7</button>
                <button class="num_button" id="eight">8</button>
                <button class="num_button" id="nine">9</button>
                <button class="op_button" id="x">x</button>
                <button class="num_button" id="zero">0</button>
                <button class="num_button" id="decimal">.</button>
                <button class="num_button" id="del">DEL</button>
                <button class="op_button" id="divide">&divide</button>
                <button class="num_button" id="clr">CLR</button>
                <button class="op_button" id="equal">=</button>
            </div>

        </div>
    </div>

     <script type="text/javascript" src="calc.js"></script>
    <script>
        const screen_text = document.querySelector('#text');

        const button1 = document.querySelector('#one');
        const button2 = document.querySelector('#two');
        const button3 = document.querySelector('#three');
        const button4 = document.querySelector('#four');
        const button5 = document.querySelector('#five');
        const button6 = document.querySelector('#six');
        const button7 = document.querySelector('#seven');
        const button8 = document.querySelector('#eight');
        const button9 = document.querySelector('#nine');
        const button0 = document.querySelector('#zero');

        const add_button = document.querySelector('#add');
        const minus_button = document.querySelector('#minus');
        const x_button = document.querySelector('#x');
        const divide_button = document.querySelector('#divide');

        const decimal_button = document.querySelector('#decimal');
        const equal_button = document.querySelector('#equal');
        const clear_button = document.querySelector('#clear');

        let math_statement = {};
        let math_statement_list = [];
        let mode_state_machine = {num1:true, operator_can_be_entered:false, num2:false, num1_decimal_used:false, num2_decimal_used:false};
        let operator_entry_mode = false;
        let decimal_not_used = false;

        button1.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                console.log("roc1");
                operator_entry_mode = true;
                mode_state_machine.num1 = false;
                mode_state_machine.operator_can_be_entered = true;

                if(screen_text.textContent == '0') {
                    screen_text.textContent = "1";
                } else {

                    screen_text.textContent = screen_text.textContent + "1"
                }
            });

        button2.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                operator_entry_mode = true;
                mode_state_machine.operator_can_be_entered = true;

                screen_text.textContent = write_number(screen_text.textContent, "2")

                /*
                if(screen_text.textContent == '0') {
                    screen_text.textContent = "1";
                } else {
                screen_text.textContent = screen_text.textContent + "2";
                } */
        });

        add_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                
                
                // square_test(parseInt(slider_text.textContent));
               if(operator_entry_mode) {
                   console.log("roqqq " + Object.keys(math_statement).length );
                   if(Object.keys(math_statement).length < 1) {
                        console.log("plus") 
                        math_statement['num1'] = screen_text.textContent;
                        math_statement['operator'] = "+"; 

                        operator_entry_mode = false;
                        mode_state_machine.num1 = true;
                        mode_state_machine.operator_can_be_entered = false;
                        // let mode_state_machine = {num1:true, operator:false, num2:false, num1_decimal_used:false, num2_decimal_used:false};
                       // math_statement_list.push(screen_text.textContent);
                       // math_statement_list.push(" + ")
                        
                        console.log("+++")
                       
                        screen_text.textContent = screen_text.textContent + " + ";            
                        //console.log(math_statement_list);
                   } else {
                        let temp_list = screen_text.textContent.split(' ')
                        console.log(temp_list);
                        console.log("***")
                        math_statement['num2'] = temp_list[2];

                        math_statement['num1'] = operations['add'](parseFloat(math_statement['num1']), parseFloat(math_statement['num2']));
                        math_statement['operator'] = "+";
                        operator_entry_mode = false;
                        
                        //math_statement_list[0] = operations['add'](parseFloat(math_statement_list[0]), parseFloat(temp_list[2]));
                        // math_statement_list[1] ="+";
                        
                        
                        screen_text.textContent = String(math_statement['num1']) + " + ";
                        // math_statement['num2'] = 0;
                        delete math_statement.num2;
                        //console.log(math_statement_list);
                        
                    }
                }
               
               
               

        });

        minus_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                if(mode_state_machine.operator_can_be_entered) {
                   // screen_text.textContent = write_number(screen_text.textContent, " - "); 
                   let op_list = op_processor(mode_state_machine, math_statement, screen_text.textContent, "-", "minus" )
                   screen_text.textContent = op_list[2];
                   mode_state_machine = op_list[0];
                   math_statement = op_list[1];  
                }
                operator_entry_mode = false;
        });

        x_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                if(operator_entry_mode) {
                   screen_text.textContent = screen_text.textContent + " x "; 
                }
                operator_entry_mode = false;
        });

        divide_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                if(operator_entry_mode) {
                   screen_text.textContent = screen_text.textContent + " " + "\u00F7" + " ";
                }
                operator_entry_mode = false;
        })



        

    </script>
    
</body>
</html>