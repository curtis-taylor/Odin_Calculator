<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        
        <div id="calculator">
            <div id="screen">
                <div id="text">0</div>
            </div>
            <div class="button_container">
                <button class="num_button" id="one">1</button>
                <button class="num_button" id="two">2</button>
                <button class="num_button" id="three">3</button>
                <button class="op_button" id="add">+</button>
                <button class="num_button" id="four">4</button>
                <button class="num_button" id="five">5</button>
                <button class="num_button" id="six">6</button>
                <button class="op_button" id="minus">-</button>
                <button class="num_button" id="seven">7</button>
                <button class="num_button" id="eight">8</button>
                <button class="num_button" id="nine">9</button>
                <button class="op_button" id="x">x</button>
                <button class="num_button" id="zero">0</button>
                <button class="num_button" id="decimal">.</button>
                <button class="num_button" id="back">&#x232B;</button>
                <button class="op_button" id="divide">&divide</button>
                <button class="num_button" id="clear">CLR</button>
                <button class="op_button" id="equal">=</button>
            </div>

        </div>
    </div>

     <script type="text/javascript" src="calc.js"></script>
    <script>
        const screen_text = document.querySelector('#text');

        const button1 = document.querySelector('#one');
        const button2 = document.querySelector('#two');
        const button3 = document.querySelector('#three');
        const button4 = document.querySelector('#four');
        const button5 = document.querySelector('#five');
        const button6 = document.querySelector('#six');
        const button7 = document.querySelector('#seven');
        const button8 = document.querySelector('#eight');
        const button9 = document.querySelector('#nine');
        const button0 = document.querySelector('#zero');

        const add_button = document.querySelector('#add');
        const minus_button = document.querySelector('#minus');
        const x_button = document.querySelector('#x');
        const divide_button = document.querySelector('#divide');

        const decimal_button = document.querySelector('#decimal');
        const equal_button = document.querySelector('#equal');
        const clear_button = document.querySelector('#clear');
        const back_button = document.querySelector('#back');

        let math_statement = {num1:'0', num2:'', operator:'', operation:''};
        let math_statement_list = [];
        let mode_state_machine = {num1:true, operator_can_be_entered:false, num2:false, num1_decimal_used:false, num2_decimal_used:false};
        let operator_entry_mode = false;
        let decimal_not_used = false;

        
        
        back_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                
                console.log(screen_text.textContent != "0");

                let temp = [math_statement.num1, math_statement.operator, math_statement.num2]

                if(screen_text.textContent != "0") {
                    console.log("roc22");
                    if(math_statement.num2.length > 0 ){
                        math_statement.num2 = math_statement.num2.slice(0, -1);
                        
                        if(math_statement.num2.length > 0) {
                            screen_text.textContent = math_statement.num1 + " " + math_statement.operator + " " + math_statement.num2;
                        } else {
                            screen_text.textContent = math_statement.num1 + " " + math_statement.operator + " ";
                        }

                    } else if(math_statement.operator.length > 0) {
                        math_statement.operator = "";
                        mode_state_machine.operator_can_be_entered = true;
                        screen_text.textContent = math_statement.num1;

                    } else {
                        console.log("else")
                        if(math_statement.num1.length > 0) {
                            math_statement.num1 = math_statement.num1.slice(0, -1);
                            screen_text.textContent = math_statement.num1;
                        } 

                        if(math_statement.num1.length == 0) {
                            math_statement.num1 = '0';
                            screen_text.textContent = '0';
                        }


                    }
                }

                //mode_state_machine.num1 = false;
                //mode_state_machine.operator_can_be_entered = true;

                //screen_text.textContent = write_char(screen_text.textContent, "1")
                

                if(math_statement.operator != '') {
                    let temp = screen_text.textContent.split(" ");
                    math_statement.num2 = temp[2];
                    console.log("num2 button one " + math_statement.num1 + " " + math_statement.num2);
                } else {
                    math_statement.num1 = screen_text.textContent;
                    console.log("num1 button one " + math_statement.num1);
                }

                control_text_property(screen_text);
               
            });

        button1.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                console.log("roc1 " + (math_statement.num2 != '0'));
                operator_entry_mode = true;
                mode_state_machine.num1 = false;
                mode_state_machine.operator_can_be_entered = true;

                //screen_text.textContent = write_char(screen_text.textContent, "1")
                

                if(math_statement.operator != '') {
                    let temp = screen_text.textContent.split(" ");
                    math_statement.num2 = temp[2];
                
                    console.log("num2 button one " + math_statement.num1 + " " + math_statement.operator + " " + math_statement.num2);
                    if(math_statement.num2 != '0') {
                        console.log("11%% " + math_statement.operator);
                        math_statement.num2 = write_char(math_statement.num2, "1");
                        screen_text.textContent = math_statement.num1 + " " + math_statement.operator + " " + math_statement.num2;
                        control_text_property(screen_text);
                    } 
                } else {
                    math_statement.num1 = write_char(screen_text.textContent, "1");
                    screen_text.textContent = math_statement.num1;
                    control_text_property(screen_text);
                    console.log("num1 button one " + math_statement.num1);
                }
               
            });

        button2.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                // operator_entry_mode = true;
                mode_state_machine.operator_can_be_entered = true;

                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "2");
                screen_text.textContent = temp_list[0];
                console.log(temp_list[0] + " HH");
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];

                /*
                screen_text.textContent = write_char(screen_text.textContent, "2")

                if(math_statement.operator != '') {
                    let temp = screen_text.textContent.split(" ");
                    math_statement.num2 = temp[2];
                   // console.log("num2 button one " + math_statement.num1 + " " + math_statement.num2);
                } else {
                    math_statement.num1 = screen_text.textContent;
                   // console.log("num1 button one " + math_statement.num1);
                } */

                /*
                if(screen_text.textContent == '0') {
                    screen_text.textContent = "1";
                } else {
                screen_text.textContent = screen_text.textContent + "2";
                } */
        });

        button3.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
              
                mode_state_machine.operator_can_be_entered = true;


                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "3");
                screen_text.textContent = temp_list[0];
                console.log(temp_list[0] + " HH");
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];

                /*
                if(math_statement.operator != '') {
                    let temp = screen_text.textContent.split(" ");
                    math_statement.num2 = temp[2];
                   
                } else {
                    math_statement.num1 = screen_text.textContent;
                   
                } */

        });

        button4.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
              
                mode_state_machine.operator_can_be_entered = true;

                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "4");
                screen_text.textContent = temp_list[0];
                console.log(temp_list[0] + " HH");
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];
        });

        button5.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
              
                mode_state_machine.operator_can_be_entered = true;

                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "5");
                screen_text.textContent = temp_list[0];
                console.log(temp_list[0] + " HH");
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];
        });

        button6.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
              
                mode_state_machine.operator_can_be_entered = true;

                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "6");
                screen_text.textContent = temp_list[0];
                console.log(temp_list[0] + " HH");
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];
        });

        button7.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
              
                mode_state_machine.operator_can_be_entered = true;

                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "7");
                screen_text.textContent = temp_list[0];
                console.log(temp_list[0] + " HH");
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];
        });

        button8.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
              
                mode_state_machine.operator_can_be_entered = true;

                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "8");
                screen_text.textContent = temp_list[0];
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];
        });

        button9.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
              
                mode_state_machine.operator_can_be_entered = true;

                let temp_list = number_processor( math_statement.operator, screen_text.textContent, "9");
                screen_text.textContent = temp_list[0];
                math_statement.num1 = temp_list[1];
                math_statement.num2 = temp_list[2];
        });

        

        button0.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                console.log("roc");
                
                operator_entry_mode = true;
                mode_state_machine.operator_can_be_entered = true;
    

                if(math_statement.operator != '') {

                    let temp = screen_text.textContent.split(" ");
                    math_statement.num2 = temp[2];
                    console.log("num2 button one " + math_statement.num1 + " " + math_statement.num2);
                    math_statement.num2 = write_char(math_statement.num2, "0")
                    temp[2] = math_statement.num2;
                    screen_text.textContent = temp.join(' ');
                    control_text_property(screen_text);

                    
                } else {
                    math_statement.num1 = screen_text.textContent;
                    // console.log("_____" + math_statement.num1)
                    math_statement.num1 = write_char(math_statement.num1, "0")
                    screen_text.textContent = math_statement.num1;
                    control_text_property(screen_text);
                    console.log("num1 button one " + math_statement.num1);
                }

                /*
                if(screen_text.textContent == '0') {
                    screen_text.textContent = "1";
                } else {
                screen_text.textContent = screen_text.textContent + "2";
                } */
        });

        add_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                
                // square_test(parseInt(slider_text.textContent));
                if(mode_state_machine.operator_can_be_entered) {
                   // screen_text.textContent = write_number(screen_text.textContent, " - "); 
                   let op_list = op_processor(mode_state_machine, math_statement, screen_text.textContent, "+", "add" )
                   screen_text.textContent = op_list[2];
                   mode_state_machine = op_list[0];
                   math_statement = op_list[1];  

                   
                }

                console.log("add " + math_statement.num2)
                operator_entry_mode = false;              
              
                /*
                if(operator_entry_mode) {
                   console.log("roqqq " + Object.keys(math_statement).length );
                   if(Object.keys(math_statement).length < 2) {
                        console.log("plus") 
                        math_statement['num1'] = screen_text.textContent;
                        math_statement['operator'] = "+"; 
                        math_statement['operation'] = 'add';

                        operator_entry_mode = false;
                        mode_state_machine.num1 = true;
                        mode_state_machine.operator_can_be_entered = false;
                        // let mode_state_machine = {num1:true, operator:false, num2:false, num1_decimal_used:false, num2_decimal_used:false};
                       // math_statement_list.push(screen_text.textContent);
                       // math_statement_list.push(" + ")
                        
                        console.log("+++")
                       
                        screen_text.textContent = screen_text.textContent + " + ";            
                        //console.log(math_statement_list);
                   } else {
                        let temp_list = screen_text.textContent.split(' ')
                        console.log(temp_list);
                        console.log("***")
                        math_statement['num2'] = temp_list[2];

                        math_statement['num1'] = operations[math_statement.operation](parseFloat(math_statement['num1']), parseFloat(math_statement['num2']));
                        math_statement['operator'] = "+";
                        math_statement['add'];
                        operator_entry_mode = false;
                        
                        //math_statement_list[0] = operations['add'](parseFloat(math_statement_list[0]), parseFloat(temp_list[2]));
                        // math_statement_list[1] ="+";
                        
                        
                        screen_text.textContent = String(math_statement['num1']) + " + ";
                        // math_statement['num2'] = 0;
                        delete math_statement.num2;
                        //console.log(math_statement_list);
                        
                    }
                }
               
               */
               

        });

        minus_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                if(mode_state_machine.operator_can_be_entered) {
                   // screen_text.textContent = write_number(screen_text.textContent, " - "); 
                   let op_list = op_processor(mode_state_machine, math_statement, screen_text.textContent, "-", "minus" )
                   screen_text.textContent = op_list[2];
                   mode_state_machine = op_list[0];
                   math_statement = op_list[1];  
                }
                operator_entry_mode = false;
        });

        x_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                 if(mode_state_machine.operator_can_be_entered) {
                   // screen_text.textContent = write_number(screen_text.textContent, " - "); 
                   console.dir(" x button " + Object.keys(math_statement).length)
                   
                   let op_list = op_processor(mode_state_machine, math_statement, screen_text.textContent, "x", "multiply" )
                   screen_text.textContent = op_list[2];
                   mode_state_machine = op_list[0];
                   math_statement = op_list[1];  
                }
                operator_entry_mode = false;
        });

        divide_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                //console.log("roc");
                // square_test(parseInt(slider_text.textContent));
             
                /* if(operator_entry_mode) {
                   screen_text.textContent = screen_text.textContent + " " + "\u00F7" + " ";
                }
                operator_entry_mode = false; */

                if(mode_state_machine.operator_can_be_entered) {
                   // screen_text.textContent = write_number(screen_text.textContent, " - "); 
                   console.dir(" x button " + Object.keys(math_statement).length)
                   
                   let op_list = op_processor(mode_state_machine, math_statement, screen_text.textContent, "\u00F7", "divide" )
                   screen_text.textContent = op_list[2];
                   mode_state_machine = op_list[0];
                   math_statement = op_list[1];  
                }
                operator_entry_mode = false;
        });

        clear_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                console.log("roc");
                // square_test(parseInt(slider_text.textContent));
                operator_entry_mode = true;
                mode_state_machine.operator_can_be_entered = true;

                screen_text.textContent = "0";

               math_statement = {num1:'0', num2:'', operator:'', operation:''};
                mode_state_machine = {num1:true, operator_can_be_entered:false, num2:false, num1_decimal_used:false, num2_decimal_used:false};
                //operator_entry_mode = false;
                //operator_entry_mode = false;

                
        });

        decimal_button.addEventListener("click", function(e) {
                e.preventDefault();
                //e.stopPropagation();
                e.stopImmediatePropagation();
                console.log("roc");
                // square_test(parseInt(slider_text.textContent));

                if((math_statement['operator']) && (math_statement['num2'])) {
                    console.log("decimal insert into num2")
                    console.log("1st ")
                    if(!(math_statement['num2']).includes('.')) {
    
                        screen_text.textContent = write_char(screen_text.textContent, ".");
                        let temp = screen_text.textContent.split(" ");
                        math_statement.num2 = temp[2];
                        control_text_property(screen_text);
                    }
                    
                } 
                else if((math_statement['operator'])) {
                    console.log("decimal first char for num2");

                    screen_text.textContent = screen_text.textContent + "0.";
                    
                    math_statement.num2 = "0.";

                }
                else if(!(math_statement['num1']).includes('.')) {
                   // if(!(math_statement['num2']).includes('.')) { }
                    screen_text.textContent = write_char(screen_text.textContent, ".");
                    math_statement.num1 = screen_text.textContent;
                    control_text_property(screen_text);

                    console.log("2nd ")
                }
                else {

                    console.log("decimal insert into num1")
                }

                

                //  let mode_state_machine = {num1:true, operator_can_be_entered:false, num2:false, num1_decimal_used:false, num2_decimal_used:false};
                // mode_state_machine.operator_can_be_entered = true;

                //screen_text.textContent = "";

                //math_statement = {operation:''};
               // mode_state_machine = {num1:true, operator_can_be_entered:false, num2:false, num1_decimal_used:false, num2_decimal_used:false};
                //operator_entry_mode = false;
                //operator_entry_mode = false;

                
        });



        

    </script>
    
</body>
</html>